#![no_std]

use volatile_cell::VolatileCell;

// Known to apply to:
//  STM32F4
ioregs!(RCC = {
    0x00 => reg32 cr {
        0 => hsi_on : rw,
        1 => hsi_rdy : ro,
        3..7 => hsi_trim : rw,
        8..15 => hsi_cal : ro,
        16 => hse_on : rw,
        17 => hse_rdy : ro,
        18 => hse_byp : rw,
        19 => css_on : rw,
        24 => pll_on : rw,
        25 => pll_rdy : ro,
        26 => pll_i2s_on : rw,
        27 => pll_i2s_rdy : ro,
        28 => pll_sai_on : rw,
        29 => pll_sai_rdy : ro,
    },
    0x04 => reg32 pll_cfgr {
        0 => pllm0 : rw,
        1 => pllm1 : rw,
        2 => pllm2 : rw,
        3 => pllm3 : rw,
        4 => pllm4 : rw,
        5 => pllm5 : rw,
        6..14 => plln : rw,
        16 => pllp0 : rw,
        17 => pllp1 : rw,
        22 => pllsrc : rw,
        24 => pllq0 : rw,
        25 => pllq1 : rw,
        26 => pllq2 : rw,
        27 => pllq3 : rw,
    },
    0x08 => reg32 cfgr {
        0 => sw0 : rw,
        1 => sw1 : rw,
        2 => sws0 : ro,
        3 => sws1 : ro,
        4..7 => hpre : rw,
        10..12 => ppre1 : rw,
        13..15 => ppre2 : rw,
        16..20 => rtcpre : rw,
        21..22 => mco1 : rw,
        23 => i2s_src : rw,
        24..26 => mco1_pre : rw,
        27..29 => mco2_pre : rw,
        30..31 => mco2 : rw,
    }
    0x0c => reg32 cir {
        0 => lsi_rdyf : ro,
        1 => lse_rdyf : ro,
        2 => hsi_rdyf : ro,
        3 => hse_rdyf : ro,
        4 => pll_rdyf : ro,
        5 => pll_i2s_rdyf : ro,
        6 => pll_sai_rdyf : ro,
        7 => cssf : ro,
        8 => lsi_rdyie : rw,
        9 => lse_rdyie : rw,
        10 => hsi_rdyie : rw,
        11 => hse_rdyie : rw,
        12 => pll_rdyie : rw,
        13 => pll_i2s_rdyie : rw,
        14 => pll_sai_rdyie : rw,
        16 => lsi_rdyc : wo,
        17 => lse_rdyc : wo,
        18 => hsi_rdyc : wo,
        19 => hse_rdyc : wo,
        20 => pll_rdyc : wo,
        21 => pll_i2s_rdyc : wo,
        22 => pll_sai_rdyc : wo,
        23 => cssc : wo,
    },
    0x10 => reg32 ahb1rstr {
        0 => gpioa_rst : rw,
        1 => gpiob_rst : rw,
        2 => gpioc_rst : rw,
        3 => gpiod_rst : rw,
        4 => gpioe_rst : rw,
        5 => gpiof_rst : rw,
        6 => gpiog_rst : rw,
        7 => gpioh_rst : rw,
        8 => gpioi_rst : rw,
        9 => gpioj_rst : rw,
        10 => gpiok_rst : rw,
        12 => crc_rst : rw,
        21 => dma1_rst : rw,
        22 => dma2_rst : rw,
        23 => dma2d_rst : rw,
        25 => eth_mac_rst : rw,
        29 => otghs_rst : rw,
    },
    0x14 => reg32 ahb2rstr {
        0 => dcmi_rst : rw,
        4 => cryp_rst : rw,
        5 => hash_rst : rw,
        6 => rng_rst : rw,
        7 => otgfs_rst : rw,
    },
    0x18 => reg32 ahb3rstr {
        0 => fmc_rst : rw,
    },
    0x20 => reg32 apb1rstr {
        0 => tim2_rst : rw,
        1 => tim3_rst : rw,
        2 => tim4_rst : rw,
        3 => tim5_rst : rw,
        4 => tim6_rst : rw,
        5 => tim7_rst : rw,
        6 => tim12_rst : rw,
        7 => tim13_rst : rw,
        8 => tim14_rst : rw,
        11 => wwdg_rst : rw,
        14 => spi2_rst : rw,
        15 => spi3_rst : rw,
        17 => uart2_rst : rw,
        18 => uart3_rst : rw,
        19 => uart4_rst : rw,
        20 => uart5_rst : rw,
        21 => i2c1_rst : rw,
        22 => i2c2_rst : rw,
        23 => i2c3_rst : rw,
        25 => can1_rst : rw,
        26 => can2_rst : rw,
        28 => pwr_rst : rw,
        29 => dac_rst : rw,
        30 => uart7_rst : rw,
        31 => uart8_rst : rw,
    },
    0x24 => reg32 apb2rstr {
        0 => tim1_rst : rw,
        1 => tim8_rst : rw,
        4 => usart1_rst : rw,
        5 => usart6_rst : rw,
        8 => adc_rst : rw,
        11 => sdio_rst : rw,
        12 => spi1_rst : rw,
        13 => spi4_rst : rw,
        14 => syscfg_rst : rw,
        16 => tim9_rst : rw,
        17 => tim10_rst : rw,
        18 => tim11_rst : rw,
        20 => spi5_rst : rw,
        21 => spi6_rst : rw,
        22 => sai1_rst : rw,
        26 => ltdc_rst : rw,
    },
    0x30 => reg32 ahb1enr {
        0 => gpioa_en : rw,
        1 => gpiob_en : rw,
        2 => gpioc_en : rw,
        3 => gpiod_en : rw,
        4 => gpioe_en : rw,
        5 => gpiof_en : rw,
        6 => gpiog_en : rw,
        7 => gpioh_en : rw,
        8 => gpioi_en : rw,
        9 => gpioj_en : rw,
        10 => gpiok_en : rw,
        12 => crc_en : rw,
        18 => bkpsram_en : rw,
        20 => ccmdataram_en : rw,
        21 => dma1_en : rw,
        22 => dma2_en : rw,
        23 => dma2d_en : rw,
        25 => eth_mac_en : rw,
        26 => eth_mac_tx_en : rw,
        27 => eth_mac_rx_en : rw,
        28 => eth_mac_ptp_en : rw,
        29 => otghs_en : rw,
        30 => otghsulpi_en : rw,
    },
    0x34 => reg32 ahb2enr {
        0 => dcmi_en : rw,
        4 => cryp_en : rw,
        5 => hash_en : rw,
        6 => rng_en : rw,
        7 => otgfs_en : rw,
    },
    0x38 => reg32 ahb3enr {
        0 => fmc_en : rw,
    },
    0x40 => reg32 apb1enr {
        0 => tim2_en : rw,
        1 => tim3_en : rw,
        2 => tim4_en : rw,
        3 => tim5_en : rw,
        4 => tim6_en : rw,
        5 => tim7_en : rw,
        6 => tim12_en : rw,
        7 => tim13_en : rw,
        8 => tim14_en : rw,
        11 => wwdg_en : rw,
        14 => spi2_en : rw,
        15 => spi3_en : rw,
        17 => uart2_en : rw,
        18 => uart3_en : rw,
        19 => uart4_en : rw,
        20 => uart5_en : rw,
        21 => i2c1_en : rw,
        22 => i2c2_en : rw,
        23 => i2c3_en : rw,
        25 => can1_en : rw,
        26 => can2_en : rw,
        28 => pwr_en : rw,
        29 => dac_en : rw,
        30 => uart7_en : rw,
        31 => uart8_en : rw,
    },
    0x44 => reg32 apb2enr {
        0 => tim1_en : rw,
        1 => tim8_en : rw,
        4 => usart1_en : rw,
        5 => usart6_en : rw,
        8 => adc1_en : rw,
        9 => adc2_en : rw,
        10 => adc3_en : rw,
        11 => sdio_en : rw,
        12 => spi1_en : rw,
        13 => spi4_en : rw,
        14 => syscfg_en : rw,
        16 => tim9_en : rw,
        17 => tim10_en : rw,
        18 => tim11_en : rw,
        20 => spi5_en : rw,
        21 => spi6_en : rw,
        22 => sai1_en : rw,
        26 => ltdc_en : rw,
    },
    0x50 => reg32 ahb1lpenr {
        0 => gpioa_lpen : rw,
        1 => gpiob_lpen : rw,
        2 => gpioc_lpen : rw,
        3 => gpiod_lpen : rw,
        4 => gpioe_lpen : rw,
        5 => gpiof_lpen : rw,
        6 => gpiog_lpen : rw,
        7 => gpioh_lpen : rw,
        8 => gpioi_lpen : rw,
        9 => gpioj_lpen : rw,
        10 => gpiok_lpen : rw,
        12 => crc_lpen : rw,
        15 => flitf_lpen : rw,
        16 => sram1_lpen : rw,
        17 => sram2_lpen : rw,
        18 => bkpsram_lpen : rw,
        19 => sram3_lpen : rw,
        21 => dma1_lpen : rw,
        22 => dma2_lpen : rw,
        23 => dma2d_lpen : rw,
        25 => eth_mac_lpen : rw,
        26 => eth_mac_tx_lpen : rw,
        27 => eth_mac_rx_lpen : rw,
        28 => eth_mac_ptp_lpen : rw,
        29 => otghs_lpen : rw,
        30 => otghsulpi_lpen : rw,
    },
    0x54 => reg32 ahb2lpenr {
        0 => dcmi_lpen : rw,
        4 => cryp_lpen : rw,
        5 => hash_lpen : rw,
        6 => rng_lpen : rw,
        7 => otgfs_lpen : rw,
    },
    0x58 => reg32 ahb3lpenr {
        0 => fmc_lpen : rw,
    },
    0x60 => reg32 apb1lpenr {
        0 => tim2_lpen : rw,
        1 => tim3_lpen : rw,
        2 => tim4_lpen : rw,
        3 => tim5_lpen : rw,
        4 => tim6_lpen : rw,
        5 => tim7_lpen : rw,
        6 => tim12_lpen : rw,
        7 => tim13_lpen : rw,
        8 => tim14_lpen : rw,
        11 => wwdg_lpen : rw,
        14 => spi2_lpen : rw,
        15 => spi3_lpen : rw,
        17 => uart2_lpen : rw,
        18 => uart3_lpen : rw,
        19 => uart4_lpen : rw,
        20 => uart5_lpen : rw,
        21 => i2c1_lpen : rw,
        22 => i2c2_lpen : rw,
        23 => i2c3_lpen : rw,
        25 => can1_lpen : rw,
        26 => can2_lpen : rw,
        28 => pwr_lpen : rw,
        29 => dac_lpen : rw,
        30 => uart7_lpen : rw,
        31 => uart8_lpen : rw,
    },
    0x64 => reg32 apb2lpenr {
        0 => tim1_lpen : rw,
        1 => tim8_lpen : rw,
        4 => usart1_lpen : rw,
        5 => usart6_lpen : rw,
        8 => adc1_lpen : rw,
        9 => adc2_lpen : rw,
        10 => adc3_lpen : rw,
        11 => sdio_lpen : rw,
        12 => spi1_lpen : rw,
        13 => spi4_lpen : rw,
        14 => syscfg_lpen : rw,
        16 => tim9_lpen : rw,
        17 => tim10_lpen : rw,
        18 => tim11_lpen : rw,
        20 => spi5_lpen : rw,
        21 => spi6_lpen : rw,
        22 => sai1_lpen : rw,
        26 => ltdc_lpen : rw,
    },
    0x70 => reg32 bdcr {
        0 => lse_on : rw,
        1 => lse_rdy : ro,
        2 => lse_byp : rw,
        8..9 => rtc_sel : rw,
        15 => rtc_en : rw,
        16 => bd_rst : rw,
    },
    0x74 => reg32 csr {
        0 => lsi_on : rw,
        1 => lsi_rdy : ro,
        24 => rmvf : rw,
        25 => bor_rstf : ro,
        26 => pin_rstf : ro,
        27 => por_rstf : ro,
        28 => sft_rstf : ro,
        29 => iwdg_rstf : ro,
        30 => wwdg_rstf : ro,
        31 => lpwr_rstf : ro,
    },
    0x80 => reg32 sscgr {
        0..12 => modper : rw,
        13..27 => incstep : rw,
        30 => spread_sel : rw,
        31 => sscg_en : rw,
    },
    0x84 => reg32 plli2s_cfgr {
        6..14 => plli2s_n : rw,
        24..27 => plli2s_q : rw,
        28..30 => plli2s_r : rw,
    },
    0x88 => reg32 pllsai_cfgr {
        6..14 => pllsai_n : rw,
        24..27 => pllsai_q : rw,
        28..30 => pllsai_r : rw,
    },
    0x8c => reg32 dck_cfgr {
        0..4 => plli2s_divq : rw,
        8..12 => pllsai_divq : rw,
        16..17 => pllsai_divr : rw,
        20..21 => pllsai1a_src : rw,
        22..23 => pllsai1b_src : rw,
        24 => timpre : rw,
    },
});
